<!DOCTYPE HTML>
<html>
    <head>
        <title>utmz parser</title>
        <script src="/scripts/js.cookie.js"></script>
        <script>
            (function(){
                /* - I believe this is the format that needs to go into the dataLayer
                [domain] => 1
                [timestamp] => 1276242664
                [visits] => 248
                [sources] => 7
                [campaign] => search
                [source] => (organic)
                [medium] => organic
                [keyword] => sticky orange
                */

                //Initialise the dataLayer if one isn't already defined
                window.dataLayer = window.dataLayer || [];
                
                //get the cookie
                var cookie = Cookies.get('__utmz');
                //var cookie = '79104832.1302099445.45.9.utmcsr=google|utmccn=(organic)|utmcmd=organic|utmctr=human%20quality%20management%20eduhub';

                if(cookie){
                    //first, split the cookie value by . to separate the initial 4 values
                    var z = cookie.split('.');

                    window.dataLayer.push({'domain': z[0]});
                    window.dataLayer.push({'timestamp': z[1]});
                    window.dataLayer.push({'visits': z[2]});
                    window.dataLayer.push({'sources': z[3]});

                    if (z.length >= 4) {
                        //now split the latter part of the cookie
                        var y = z[4].split('|');
                        for (i = 0; i < y.length; i++) {

                            //get the value for each key=value pair
                            var pair = y[i].split("=");

                            switch(pair[0]){

                                case "utmcsr":
                                window.dataLayer.push({'campaign': pair[1]});
                                break;

                                case "utmccn":
                                window.dataLayer.push({'source': pair[1]});
                                break;

                                case "utmcmd":
                                window.dataLayer.push({'medium': pair[1]});
                                break;

                                case "utmctr":
                                window.dataLayer.push({'keyword': pair[1]});
                                break;
                            }
                        }
                    }

                    console.log(window.dataLayer);
                }
            }());
        </script>
        <script>
            /*
                Google TM script here
            */
        </script>
    </head>
    <body>
        <h1>utmz parser</h1>

    </body>
</html>